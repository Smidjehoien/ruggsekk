package license

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestParse(t *testing.T) {
	type args struct {
		licenseText string
	}
	tests := []struct {
		name    string
		args    args
		want    *License
		wantErr string
	}{
		{
			name: "Valid license",
			args: args{
				licenseText: "MTo4Nzg5NGE2NjNlMTE1YWE3YmJjYmFiOGNhNzkxZTg3NDQ3OWM3ZDMyMGJlNzNjZGFiZDFmOWIyODA5YzUxNGNkYjM0YWU4OTkzNTFhMjBiYzkxNTg1OTNhOGRhYjdlNDY0NTY4MmQzYWI2Y2U4YzE1ZTBlOTE1OWEwNTJlZGFlMmFjNjA3ZmJkNzAzYzI1MDYzZjViNjYzZTJhNTVjODYyNTBmOWU1YzMwYWI5NTJjMGZkYmM3OTViY2E3NTQ2Mzc0NWM0NDljY2M2OThiYzM5YWYyMjkwODg3MjMzM2NkYTQyZWFmZDY5OTVmNDBjNzMwZGM5YzEzODI2OTljMWE4MWI2ODE1Mjc0MGEzNzA1ZTI0MjkwZDgzNTE4NWIwODIwNWQ3MTUzM2JlMWM1NTNmMWI4MjZiNWQ3MDU2MWJjMTVjMDlhNzc1YmE3OTdmNmJlZTIzOWNiM2E3ZTNmMDJhZDhlYTFkY2E2OGNlMDlmMDY5YTUwNmE3MjU3N2VhZWQwN2M0ZTRiZWNlOTIxZWU1MWEyNzJkNmY1YmY2NjAxYzRiNzNmN2FiZDZjMjA0N2IwYzBiZTg2ODVhMWUwMWUyMjIxNjU0ZjJkYTA1YzI0ZDRmYzI3NDg1ZjMyN2NhYWJhMjkyMDdjMmY1MGY5OTBiODcwMGZjOTQ4OWE3YTg0ZDgyYzQwMDU5YWJmN2I5MDI3YjVlODNlYjJhYjNkYWM5MGZiZDZiY2E2NGIzMTMyMzI1MGZlMzIwZDBhMTJmNDQ0OTJjNjVlZjlhNDgxYWZjY2Y1ZmEwOGMxZjg2OTU0ZDRiN2YyZWM0ZTc4YTlmNmQ5MjllOWQ2MjI4ZDI1ZmQ3YjQ4YmYyZTU0MDQ1ZDY3MWM0NDljYzM5ZmJlZjRmMDE5OGE0NDNjNmJmNDUwNTM3YzY1OTg2OGU1MTg1OGNkOTMwMTIwOGNmZmU1YjhiYTZhZjNiN2Q3ZGIwNzYwZGZlOGE0NTAwNDI5M2QwNzgwZTA2YzE5NGZjYjNlMTg5ZTVkYWRlNDcyNTk0YjQ5M2VhNDQ5YzMzOTBjM2M0MTkxNGQ1YjI2NGM0NTk0ZWM1YWZjY2IyMTg4YjljMjg2MTkyYThhOWVhODQ4Yzc2NTk0Njg1ZmFlNWE3MTJjNTlkMWRlMTZmOTczODNlNDk2NGYzMDMxZmQ3NjljMThlMzI3YzkyNjU3MzU2YzBhZDNlMGZlZmQ2YjY2NTNhMTI5ZjFjYzRmYzRlOTExMzNjMjYxYWYzNGYyMmJkM2RiMjY0NzA2ZWFhMDNjZTUwNmIyYTNjZjRjMjUzY2VjNjk3MWQzN2E2Y2MwNjMxZTk2N2QzZTBmODFiNTllZjFmOWUzNDNlOjZlNjE2ZDY1M2EyMDU0NjU3Mzc0MjA1NTczNjU3MjBhNjU2ZDYxNjk2YzNhMjA3NDY1NzM3NDQwNjU3ODYxNmQ3MDZjNjUyZTYzNmY2ZDBhNjU3ODcwNjk3MjY1NzMzYTIwMzEzNjM0MzMzODM3MzMzNTMxMzMwYQ==",
			},
			want: &License{
				Name:    "Test User",
				Email:   "test@example.com",
				Expires: 1643873513,
			},
		},
		{
			name: "Invalid signature",
			args: args{
				licenseText: "MTpjNDdkZDUyODcyZWFjNzU5NWFjNTAwOWRjZThjMWY4ZjllMzg3M2JkNzYzOWZiZDQyNDc3Y2YyM2U3NmU5MGNmMjQ4MWY4MDQwOWFmMDdmZDE5MmZhMWI0N2QzZDE4ZTA0M2Y1ZGZkMzE0OTE4MmQ1YTQyN2VhMzcwOTk1ZWZjNGZmY2JlMTBhMDJmZjQxNzQ0NWEyZjY0MjJmMmU3MDQ0ZDM0Y2QzMzMwMTg0YTc2OGQ3ZWFjYTlmZjc4NWVhYWQyYjE0NGMzOTgzYjkxYTVjZjVmYWJjOTNkNDI1Y2QyNWJhMzEyYmFkMjRkMTIxZmJkYTU5ODdiOGZmNTVjN2Y3M2JhZTA3MzJjODEwZmM4MGFhNTA2MGU0ZTFkYjcwYThhOTk3NzgwNDM4NDdiN2M5ZWZlYjUzMmZmMmIwODQ5NjlhNTc4YmRlNThjYTE4MTJiYzJmMzE5ZmRiZjgzYmRiNjAxNTI2YjEyMmMwYWRmYTE5NDZlZmY2NzE1NzEzYjZiNWRmZjYwNGZmOTg5OGNhN2UzNGU0ZGIyNzZhZjhjODg4MTcxNDAzMTNjNzc1YjVjODEyNDIyNGYyZjJkNmFlYTk2MWVhOGExMWQ4OGJjZWNkZDM0MWZkYWM2Y2I2NDI3NTM2MTRjYzk4MmRlZjE1NDIxZDFmYWJmZmUzMTk1NzA0ZWRjYzczMzY1ZDFmMWQwZTM3MDg1OWU2MzllNzA4MTEzM2Y0YTc2NzZmN2VhZWE1NTljM2RiYThhMTI0Zjc2OGZkNzY4MDdmMDkyODRiMjRiYjRkNmE3YjMwZDI0ZjM2NjExOGY5NjQ2YWU4M2VjOWJkYjYzZTVmOTRhOTY4ZjY2YTIxMTE4NWU2MGRiOWJkMTg3ODdmMmFiMmM0MWJkMWRjNmNmMDZjZmFlZDI5ZTU3MmE2MTU2ZDU1NGU5NjQyYzRiNDYzYjI1OTk3ZDU2MWRmN2NhYzUzYjdiZDllZGJlNGJlNWM0ZTdiYjJkYWNjMDg0N2ViZTJlZTg2ZmFmODBiNjYxYTY3MzUyZjE1NmY2N2E4MjFkNDRhOWY2ZjVmYzlhZWIzNTdjMTgwNDdlMjc4NzkwNWVmMDM5OTIwMzFiNzhiNDMxYjg0MzRmYmQwZDM0MzA4NmJmNzg3MzY4MGMxZGYzN2RhYTVkNWVjY2M0NzdmNzkzMjMxZjU1ZTY3ODQ3YTk1ZDU1OWFkNWVhMDY4ZjY5ZGYzZTEzNDIxYmRiM2Y4YjA0MWVkYWU0ZGJkNTIwMDZlNDI3YWUwNjRjYzM5ZGJjM2U0N2FhYWM5NzE4ZmU0Mzc1ZjIxNDI4NGU4MDFjMTUwNmEwNWU1OTcwMjBhMWFiYjE4YjFjODBhOjZlNjE2ZDY1M2EyMDU0NjU3Mzc0MjA1NTczNjU3MjBhNjU2ZDYxNjk2YzNhMjA3NDY1NzM3NDQwNjU3ODYxNmQ3MDZjNjUyZTYzNmY2ZDBhNjU3ODcwNjk3MjY1NzMzYTIwMzEzOTMyMzMzNzMyMzMzODMxMzQwYQ==",
			},
			wantErr: "invalid license: verification failed",
		},
		{
			name: "Expired",
			args: args{
				licenseText: "MTozNGY0ZGFkNzE0YmU0MmRlNjIwZGNkMmQyYjViNzA1ZTBlY2VhMjVjMzBkMjI2YzcxOTM3N2IxOGIwNGQ2YTUzM2Y1OTc3Y2ZlY2I4MjFhNGJkNTgxNGI0Zjc1ZDM3YzEzZDgyNTkwZDcyMzIyZWY0N2E4MWZhYzFmYjA2YjFmZjYyYWExOTUyMjg3OGM1MzY0MThjY2Y2MDdjNTYzMmU4MDAzZGJjYmQ1Zjk3ZWMyMDMyYTdhOTEzOTUzN2U4MGE5ODc4YWIyZDMyNWU5ZGFjOGNlY2RkOGNkZjNkMzE1ZGUxNDlmNTY5MjBjZjQ0NzRjYjNlOGE5NDJlMzQ1ODZkYjhhZDViNjRlZGQzOGRhMzg0NTcyMmNlNzQ0Yjc5MmM2M2E1Zjc0NDJmY2U4YjA5NWJjMTI5NDczODYzNmJmMzliNjc3OGNiYjlkZGQ3NjA4ODFjYmM5MmUxODM1M2YwYmQxZWU2NDlhMTgxZjBmZGE0OWI3OWQ1NTM0OTRlMzNlMzdkMzk3MDllYzY2NzI4YWU1MWFmYjIxZDliZTFjZGM0YjJiMWJkOWM3NDNkNjBiNmZkOTUxMDAxNmRkYTlmMzNlM2E4NzBjOGFiMDM5MWYwOWQyNTNmYzJjMjBkMDUwNzVmMDQ4YjVkYmVkY2QwYzRkMzE5ZmM1ZWUxZTAxYmUzOGFmMGE0NzhkYjYwZjI2Zjc1NjlmMWEzZDExMWEyYzE0ZTcyOWIwOWQ4MWQ1ZjRkNDkzYTk1MzkyNzc0MDk5MTU1MmMzN2VkYjdiMDIyMzkwZWI1MmYxZDU3MGY5M2UzZjhhYjFmNGZhN2EyY2ZkNmZlMDE2YzIzMzVmOTVkMmRlMDEwYmVlN2Y5MTRhNWVkOWQ5NWQwM2VhNGUzZGQ2Njc0NGNjOTcyNWQ4YzllZTM2Y2E3ZTM4NmI3ZDliYWZiOWIzNGM0NWZlMWY2OTU3MWZmNjExYTFkNTM3OTE3YWQ3NDQxZjFjM2YwMDMyMmQwMjU2NzljMTk0OTkxN2NmZDIyOTQ1MzA1ZGYzOTdhZDg1MGQ5ZTQ0MzY5MzA2MzhjYmQ2ZjhlOGUzZjljOTMwNTMxNTBlMTM0MTJmOTJhODA0NzUyZTU2ODRjODUwMWM5ZjgyYjg3ZDZlZWM2NmVlM2M4YzAxZmU2N2NmODI1ZTdlMDdjYWQ5Y2ZlMjgzYTE3Zjk4MGJkODgwMjcwNDJmMzg5ZGU5ZWU3OTFiOTMxNGQ5YjlhNGQ3OTJiZjcwMGY2ODJlYTg3ZjVmYjQzYjg5M2IyMzc0MmI0YjVmMzg3NWYwYzBhMjU2NDE3MDJkZDQ3OTU0ZGQxMTI3MGQzNTM3MTgzZDMwMzQ2NjY2ODY5OjZlNjE2ZDY1M2EyMDU0NjU3Mzc0MjA1NTczNjU3MjBhNjU2ZDYxNjk2YzNhMjA3NDY1NzM3NDQwNjU3ODYxNmQ3MDZjNjUyZTYzNmY2ZDBhNjU3ODcwNjk3MjY1NzMzYTIwMzEzNjMxMzIzNDMyMzUzMjMyMzEwYQ==",
			},
			wantErr: "invalid license: expired",
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, err := parse(tt.args.licenseText)
			if tt.wantErr != "" {
				if assert.Error(t, err, tt.wantErr) {
					assert.Equal(t, tt.wantErr, err.Error())
				}

				return
			}

			assert.NoError(t, err)
			assert.NotNil(t, got)
			assert.Equal(t, tt.want.Name, got.Name)
			assert.Equal(t, tt.want.Email, got.Email)
			assert.Equal(t, tt.want.Expires, got.Expires)
		})
	}
}
